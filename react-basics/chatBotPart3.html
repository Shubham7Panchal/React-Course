<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ChatBot</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f5f7fb;
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .chat-container {
      width: 420px;
      max-width: 95%;
      height: 78vh;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(10, 20, 40, 0.08);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-container.with-input-top .chat-messages { padding-top: 90px; padding-bottom: 28px; }
    .chat-container.with-input-bottom .chat-messages { padding-bottom: 90px; padding-top: 28px; }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      box-sizing: border-box;
      scrollbar-width: none; /* Firefox */
    }
    .chat-messages::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    .chat-input-box {
      position: absolute;
      left: 0;
      width: 100%;
      display: flex;
      gap: 8px;
      padding: 10px;
      box-sizing: border-box;
      z-index: 12;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.95));
      align-items: center;
    }
    .chat-input-box.top { top: 0; border-bottom: 1px solid #e9edf2; }
    .chat-input-box.bottom { bottom: 0; border-top: 1px solid #e9edf2; }

    .chat-input-box input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d6dce6;
      font-size: 14px;
      outline: none;
      box-sizing: border-box;
    }
    .chat-input-box input:focus { box-shadow: 0 0 0 3px rgba(0,123,255,0.08); border-color: #9ec7ff; }

    .chat-input-box button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      background: #007bff;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      min-width: 72px;
    }
    .chat-input-box button:disabled {
      background: #a0a7b5;
      cursor: not-allowed;
    }

    .toggle-btn {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 14;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: #28a745;
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(40,167,69,0.12);
      font-size: 13px;
    }
    .toggle-btn.top { top: 10px; }
    .toggle-btn.bottom { bottom: 10px; }

    .chat-message {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      margin-bottom: 12px;
    }
    .chat-message.robot { justify-content: flex-start; }
    .chat-message.user  { justify-content: flex-end; }

    .chat-bubble {
      padding: 9px 12px;
      border-radius: 12px;
      max-width: 72%;
      line-height: 1.3;
      word-break: break-word;
      box-shadow: 0 2px 6px rgba(12,24,40,0.04);
    }
    .chat-message.robot .chat-bubble { background: #eef2f7; color: #111827; border-bottom-left-radius: 6px; }
    .chat-message.user  .chat-bubble { background: #007bff; color: white; border-bottom-right-radius: 6px; }

    .avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
    }

    @media (max-width: 420px) {
      .chat-container { height: 86vh; }
    }
  </style>
</head>
<body>
  <div class="js-container"></div>

  <script src="https://unpkg.com/supersimpledev/react.js"></script>
  <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
  <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
  <script src="https://unpkg.com/supersimpledev/babel.js"></script>

  <script type="text/babel">
    const { useEffect, useRef } = React;

    function ToggleButton({ position, setPosition }) {
      const label = position === 'top' ? 'Move chatInput bottom' : 'Move chatInput top';
      const placeClass = position === 'top' ? 'toggle-btn bottom' : 'toggle-btn top';
      return (
        <button className={placeClass} onClick={() => setPosition(position === 'top' ? 'bottom' : 'top')}>
          {label}
        </button>
      );
    }

    function ChatInput({ chatMessages, setChatMessages, position }) {
      const [inputText, setInputText] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(false);

      function saveInputText(e) {
        setInputText(e.target.value);
      }

      async function sendMessage() {
        if (isLoading || inputText.trim() === '') return;
        setIsLoading(true);
        const userMessage = inputText.trim();
        setInputText('');

        const newChatMessages = [
          ...chatMessages,
          { message: userMessage, sender: 'user', id: crypto.randomUUID() }
        ];
        setChatMessages([...newChatMessages, { message: <img src="loading-spinner.gif" style={{height: 40, margin:-15}} alt="loading.."/>, sender: 'robot', id: 'loading' }]);

        try {
          const response = await Chatbot.getResponseAsync(userMessage);
          setChatMessages([...newChatMessages, { message: response, sender: 'robot', id: crypto.randomUUID() }]);
        } catch (err) {
          setChatMessages([...newChatMessages, { message: 'Error. Please try again later.', sender: 'robot', id: crypto.randomUUID() }]);
        } finally {
          setIsLoading(false);
        }
      }

      function handleKeyDown(e) {
        if (e.key === 'Enter') sendMessage();
        else if (e.key === 'Escape') setInputText('');
      }

      return (
        <div className={`chat-input-box ${position}`}>
          <input
            type="text"
            placeholder="Type message to chatbot..."
            value={inputText}
            onChange={saveInputText}
            onKeyDown={handleKeyDown}
          />
          <button onClick={sendMessage} disabled={isLoading}>
            {isLoading ? 'Sending...' : 'Send'}
          </button>
        </div>
      );
    }

    function ChatMessageFormat({ message, sender }) {
      return (
        <div className={`chat-message ${sender}`}>
          {sender === 'robot' && <img className="avatar" src="robot.png" alt="robot" />}
          <div className="chat-bubble">{message}</div>
          {sender === 'user' && <img className="avatar" src="user.png" alt="user" />}
        </div>
      );
    }

    function ChatMessage({ chatMessages, position }) {
      const ref = React.useRef(null);

      React.useEffect(() => {
        const el = ref.current;
        if (el) {
          el.scrollTop = el.scrollHeight;
        }
      }, [chatMessages]);

      return (
        <div className="chat-messages" ref={ref}>
          {chatMessages.map((m) => (
            <ChatMessageFormat key={m.id} message={m.message} sender={m.sender} />
          ))}
        </div>
      );
    }

    function App() {
      const [chatMessages, setChatMessages] = React.useState([]);
      const [position, setPosition] = React.useState('bottom');

      return (
        <div className={`chat-container ${position === 'top' ? 'with-input-top' : 'with-input-bottom'}`}>
          <ToggleButton position={position} setPosition={setPosition} />
          <ChatMessage chatMessages={chatMessages} position={position} />
          <ChatInput chatMessages={chatMessages} setChatMessages={setChatMessages} position={position} />
        </div>
      );
    }

    const container = document.querySelector('.js-container');
    ReactDOM.createRoot(container).render(<App />);
  </script>
</body>
</html>
